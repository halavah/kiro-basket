# 社区团购管理平台 - 毕业设计需求文档

## 一、项目概述

### 1.1 项目定位
毕业设计级别的社区团购管理平台，PC 端 Web 系统，包含**用户端（居民端）**和**管理端（团长端）**。

### 1.2 技术栈
- **前端**: Vue 3 + Element Plus
- **后端**: Node.js + Express
- **数据库**: MySQL + MongoDB（双数据库必须同时使用）
- **认证**: JWT Token

### 1.3 系统架构
```
用户端（居民 PC Web） ──┐
                        ├──> 后端 API (Node.js) ──> MySQL + MongoDB
管理端（团长 PC Web） ──┘
```

---

## 二、系统双端功能

### 2.1 用户端（居民端）- PC Web

#### 功能列表
1. **居民注册/登录**
   - 手机号 + 密码注册
   - 登录后可下单

2. **商品浏览**
   - 按分类浏览商品
   - 搜索商品
   - 查看商品详情（图片、价格、库存、描述）

3. **购物车**
   - 添加商品到购物车
   - 修改数量
   - 删除商品

4. **下单购买**
   - 填写收货信息（姓名、手机、地址）
   - 选择支付方式（模拟支付即可，点击支付直接成功）
   - 生成订单

5. **我的订单**
   - 查看订单列表（全部、待确认、配送中、已完成）
   - 查看订单详情
   - 取消订单（待确认状态下）

6. **个人中心**
   - 查看个人信息
   - 修改收货地址

---

### 2.2 管理端（团长端）- PC Web

#### 2.2.1 团长登录
- 账号密码登录（初始账号由系统预设）
- JWT Token 认证
- 登录日志记录到 MongoDB

#### 2.2.2 商品管理
**商品列表**
- 展示：商品图片、名称、分类、价格、库存、状态、销量
- 筛选：按分类、按状态（在售/下架）
- 搜索：商品名称

**商品操作**
- 新增商品：名称、分类、价格、原价、库存、图片（本地上传）、描述、佣金比例
- 编辑商品：修改信息
- 上架/下架：切换销售状态
- 删除商品：软删除

**商品分类管理**
- 分类列表（一级分类即可）
- 新增/编辑/删除分类

#### 2.2.3 订单管理
**订单列表**
- 展示：订单号、居民姓名、商品信息、订单金额、订单状态、下单时间
- 筛选：按状态（全部、待确认、配送中、已完成、已取消）
- 搜索：订单号、居民姓名

**订单详情**
- 订单基本信息
- 居民信息
- 商品清单
- 订单金额、佣金金额
- 订单状态变更记录（存 MongoDB）

**订单操作**
- 确认订单（待确认 → 配送中）
- 完成订单（配送中 → 已完成，生成佣金）
- 取消订单（恢复库存）

#### 2.2.4 居民管理
**居民列表**
- 展示：姓名、手机号、地址、累计订单数、累计消费金额、注册时间
- 搜索：姓名、手机号

**居民详情**
- 基本信息
- 历史订单列表
- 消费统计（订单数、消费金额）

#### 2.2.5 佣金统计
**佣金规则**
- 按订单完成时计算佣金
- 佣金 = 订单金额 × 商品佣金比例

**佣金展示**
- 累计佣金
- 今日佣金、本周佣金、本月佣金
- 佣金明细列表（订单号、商品、金额、佣金、时间）

#### 2.2.6 消息通知
**库存预警**
- 商品库存 ≤ 预警值时，自动生成通知（存 MongoDB）
- 预警阈值可在商品管理中设置（默认10）

**消息中心**
- 消息列表（类型、内容、时间、已读/未读）
- 标记已读/删除

**通知类型**
- 库存预警
- 新订单提醒

#### 2.2.7 数据看板
**核心指标卡片**
- 今日订单数、今日销售额、今日佣金
- 累计订单数、累计销售额、累计佣金
- 居民总数

**数据图表（使用 ECharts）**
- 近7日销售额趋势图（折线图）
- 订单状态分布图（饼图）
- 商品销售 Top5（柱状图）

**数据统计存储**
- 每日统计数据存入 MongoDB

---

## 三、数据库设计

### 3.1 MySQL（核心业务数据）

#### 表设计

**1. 团长表 (captains)**
```sql
id, username, password, phone, status, created_at, updated_at
```

**2. 居民表 (residents)**
```sql
id, username, password, phone, name, address, created_at, updated_at
```

**3. 商品分类表 (categories)**
```sql
id, name, sort, created_at, updated_at
```

**4. 商品表 (products)**
```sql
id, category_id, name, price, original_price, stock,
image, description, status(0下架1在售), commission_rate(佣金比例),
stock_alert(库存预警值), sales(销量), created_at, updated_at
```

**5. 订单表 (orders)**
```sql
id, order_no, resident_id, captain_id, total_amount,
commission_amount, status(0待确认1配送中2已完成3已取消),
created_at, updated_at
```

**6. 订单商品表 (order_items)**
```sql
id, order_id, product_id, product_name, quantity, price, subtotal
```

**7. 佣金记录表 (commissions)**
```sql
id, captain_id, order_id, amount, created_at
```

**8. 购物车表 (cart)**
```sql
id, resident_id, product_id, quantity, created_at, updated_at
```

### 3.2 MongoDB（日志和统计数据）

#### 集合设计

**1. login_logs（登录日志）**
```javascript
{
  user_type: 'captain' | 'resident',
  user_id: Number,
  username: String,
  ip: String,
  login_time: Date,
  status: 'success' | 'failed'
}
```

**2. stock_logs（库存变动记录）**
```javascript
{
  product_id: Number,
  product_name: String,
  change_type: 'sale' | 'add' | 'cancel', // 销售/进货/取消订单
  change_quantity: Number,
  before_stock: Number,
  after_stock: Number,
  created_at: Date
}
```

**3. notifications（消息通知）**
```javascript
{
  captain_id: Number,
  type: 'stock_alert' | 'new_order',
  title: String,
  content: String,
  is_read: Boolean,
  created_at: Date
}
```

**4. order_status_logs（订单状态变更记录）**
```javascript
{
  order_id: Number,
  order_no: String,
  from_status: Number,
  to_status: Number,
  created_at: Date
}
```

**5. dashboard_stats（数据看板统计）**
```javascript
{
  date: String, // 'YYYY-MM-DD'
  daily_orders: Number,
  daily_sales: Number,
  daily_commission: Number,
  new_residents: Number,
  top_products: Array // [{product_id, name, sales}]
}
```

**6. operation_logs（操作日志）**
```javascript
{
  user_type: 'captain' | 'resident',
  user_id: Number,
  module: String, // 'product', 'order', 'resident'
  action: String, // 'create', 'update', 'delete'
  details: String,
  ip: String,
  created_at: Date
}
```

### 3.3 数据库分工原则
- **MySQL**：存储核心业务数据，保证事务一致性（订单、商品、用户）
- **MongoDB**：存储日志、历史记录、统计数据，灵活扩展

---

## 四、项目目录结构

```
D:\software_yare\node192\
├── server/                # 后端项目（Node.js + Express）
│   ├── src/
│   │   ├── config/       # 配置文件
│   │   │   ├── db.mysql.js   # MySQL 连接配置
│   │   │   ├── db.mongo.js   # MongoDB 连接配置
│   │   │   └── jwt.js        # JWT 密钥配置
│   │   ├── models/       # 数据模型
│   │   │   ├── mysql/    # MySQL 模型（Sequelize ORM）
│   │   │   │   ├── Captain.js    # 团长模型
│   │   │   │   ├── Resident.js   # 居民模型
│   │   │   │   ├── Category.js   # 分类模型
│   │   │   │   ├── Product.js    # 商品模型
│   │   │   │   ├── Order.js      # 订单模型
│   │   │   │   ├── OrderItem.js  # 订单商品模型
│   │   │   │   ├── Commission.js # 佣金模型
│   │   │   │   ├── Cart.js       # 购物车模型
│   │   │   │   └── index.js      # 模型关联关系
│   │   │   └── mongo/    # MongoDB 模型（Mongoose ODM）
│   │   │       ├── LoginLog.js   # 登录日志
│   │   │       ├── StockLog.js   # 库存变动日志
│   │   │       ├── Notification.js # 消息通知
│   │   │       ├── OrderStatusLog.js # 订单状态日志
│   │   │       ├── DashboardStat.js # 数据统计
│   │   │       └── OperationLog.js # 操作日志
│   │   ├── controllers/  # 控制器（处理请求）
│   │   │   ├── auth.controller.js       # 登录注册
│   │   │   ├── product.controller.js    # 商品管理
│   │   │   ├── category.controller.js   # 分类管理
│   │   │   ├── order.controller.js      # 订单管理
│   │   │   ├── cart.controller.js       # 购物车管理
│   │   │   ├── resident.controller.js   # 居民管理
│   │   │   ├── commission.controller.js # 佣金统计
│   │   │   ├── notification.controller.js # 消息通知
│   │   │   └── dashboard.controller.js  # 数据看板
│   │   ├── routes/       # 路由定义
│   │   │   ├── index.js      # 路由汇总
│   │   │   ├── captain.routes.js  # 团长端路由
│   │   │   └── resident.routes.js # 居民端路由
│   │   ├── middlewares/  # 中间件
│   │   │   ├── auth.middleware.js    # JWT 验证中间件
│   │   │   ├── logger.middleware.js  # 日志记录中间件
│   │   │   └── upload.middleware.js  # 文件上传中间件
│   │   ├── services/     # 业务逻辑层
│   │   │   ├── auth.service.js
│   │   │   ├── product.service.js
│   │   │   ├── order.service.js
│   │   │   ├── commission.service.js
│   │   │   └── notification.service.js
│   │   ├── utils/        # 工具函数
│   │   │   ├── response.js    # 统一响应格式
│   │   │   ├── jwt.js         # JWT 工具
│   │   │   └── bcrypt.js      # 密码加密
│   │   └── app.js        # 入口文件
│   ├── uploads/          # 图片上传目录
│   ├── package.json      # 依赖配置
│   └── .env              # 环境变量配置
│
├── client-resident/      # 居民端前端（Vue 3 + Element Plus）
│   ├── src/
│   │   ├── views/        # 页面组件
│   │   │   ├── Layout.vue        # 布局组件
│   │   │   ├── Login.vue         # 登录注册页
│   │   │   ├── Home.vue          # 首页（商品列表）
│   │   │   ├── ProductDetail.vue # 商品详情页
│   │   │   ├── Cart.vue          # 购物车页
│   │   │   ├── Order.vue         # 订单列表页
│   │   │   ├── OrderDetail.vue   # 订单详情页
│   │   │   └── Profile.vue       # 个人中心页
│   │   ├── components/   # 公共组件
│   │   │   ├── Header.vue        # 顶部导航
│   │   │   ├── Footer.vue        # 底部
│   │   │   ├── ProductCard.vue   # 商品卡片
│   │   │   └── OrderCard.vue     # 订单卡片
│   │   ├── router/       # 路由配置
│   │   │   └── index.js
│   │   ├── store/        # Pinia 状态管理
│   │   │   ├── user.js       # 用户状态
│   │   │   ├── cart.js       # 购物车状态
│   │   │   └── product.js    # 商品状态
│   │   ├── api/          # API 接口封装
│   │   │   ├── request.js    # Axios 封装
│   │   │   ├── auth.js       # 登录注册接口
│   │   │   ├── product.js    # 商品接口
│   │   │   ├── cart.js       # 购物车接口
│   │   │   └── order.js      # 订单接口
│   │   ├── utils/        # 工具函数
│   │   ├── assets/       # 静态资源
│   │   └── main.js       # 入口文件
│   ├── public/           # 公共资源
│   ├── package.json
│   └── vite.config.js    # Vite 配置
│
└── client-captain/       # 团长端前端（Vue 3 + Element Plus）
    ├── src/
    │   ├── views/        # 页面组件
    │   │   ├── Layout.vue        # 布局组件
    │   │   ├── Login.vue         # 登录页
    │   │   ├── Dashboard.vue     # 数据看板
    │   │   ├── Product/          # 商品管理
    │   │   │   ├── List.vue      # 商品列表
    │   │   │   ├── Form.vue      # 商品表单
    │   │   │   └── Category.vue  # 分类管理
    │   │   ├── Order/            # 订单管理
    │   │   │   ├── List.vue      # 订单列表
    │   │   │   └── Detail.vue    # 订单详情
    │   │   ├── Resident/         # 居民管理
    │   │   │   ├── List.vue      # 居民列表
    │   │   │   └── Detail.vue    # 居民详情
    │   │   ├── Commission/       # 佣金统计
    │   │   │   └── Index.vue
    │   │   └── Notification/     # 消息通知
    │   │       └── Index.vue
    │   ├── components/   # 公共组件
    │   │   ├── Sidebar.vue       # 侧边栏
    │   │   ├── Header.vue        # 顶部导航
    │   │   └── StatCard.vue      # 统计卡片
    │   ├── router/       # 路由配置
    │   │   └── index.js
    │   ├── store/        # Pinia 状态管理
    │   │   ├── user.js
    │   │   └── app.js
    │   ├── api/          # API 接口封装
    │   │   ├── request.js
    │   │   ├── auth.js
    │   │   ├── product.js
    │   │   ├── order.js
    │   │   ├── resident.js
    │   │   ├── commission.js
    │   │   ├── notification.js
    │   │   └── dashboard.js
    │   ├── utils/        # 工具函数
    │   ├── assets/       # 静态资源
    │   └── main.js       # 入口文件
    ├── public/           # 公共资源
    ├── package.json
    └── vite.config.js    # Vite 配置

D:\software_yare\node192\aries\
│
└── chapter02/                 # 项目文档和数据库脚本
    ├── 后端API接口文档.md      # 完整的 RESTful API 文档
    ├── database/              # 数据库脚本
    │   ├── mysql/
    │   │   ├── schema.sql    # MySQL 建表脚本
    │   │   └── seed.sql      # MySQL 测试数据
    │   └── mongodb/
    │       └── init.js       # MongoDB 集合初始化
    └── README.md             # 数据库使用说明
```

---

## 五、技术选型（确定）

### 5.1 后端
- **框架**: Express
- **MySQL ORM**: Sequelize
- **MongoDB ODM**: Mongoose
- **认证**: jsonwebtoken + bcryptjs
- **文件上传**: multer
- **跨域**: cors

### 5.2 前端
- **框架**: Vue 3 + Composition API
- **UI 库**: Element Plus
- **状态管理**: Pinia
- **HTTP**: Axios
- **图表**: ECharts
- **路由**: Vue Router
- **构建工具**: Vite

---

## 六、核心功能流程

### 6.1 居民购物流程
```
注册/登录 → 浏览商品 → 加入购物车 → 提交订单 → 模拟支付 → 查看订单
```

### 6.2 团长管理流程
```
登录 → 上架商品 → 接收订单 → 确认订单 → 完成配送 → 获得佣金 → 查看数据
```

### 6.3 库存预警流程
```
订单扣减库存 → 检查库存 ≤ 预警值 → 生成通知(MongoDB) → 团长查看消息
```

### 6.4 佣金计算流程
```
订单完成 → 计算佣金(订单金额 × 佣金比例) → 写入佣金表 → 更新统计
```

---

## 七、开发计划（3天完成）

### Day 1：基础框架 + 核心功能
- [ ] 搭建后端框架（Express + MySQL + MongoDB）
- [ ] 实现双端登录认证（JWT）
- [ ] 商品管理（CRUD + 分类）
- [ ] 搭建前端框架（居民端 + 团长端）
- [ ] 实现商品展示和商品管理页面

### Day 2：订单流程 + 业务逻辑
- [ ] 购物车功能
- [ ] 下单流程（居民端）
- [ ] 订单管理（团长端）
- [ ] 居民管理
- [ ] 库存变动记录（MongoDB）
- [ ] 订单状态流转记录（MongoDB）

### Day 3：高级功能 + 优化
- [ ] 佣金统计模块
- [ ] 消息通知（库存预警）
- [ ] 数据看板（图表展示）
- [ ] 登录日志（MongoDB）
- [ ] 操作日志（MongoDB）
- [ ] 功能测试 + Bug 修复

---

## 八、简化说明（毕业设计适配）

### 已简化内容
1. **支付功能**：不对接真实支付，点击支付直接成功
2. **图片上传**：本地存储，不用云存储
3. **消息推送**：只做系统内通知，不发短信/微信
4. **权限系统**：简单的 JWT 认证即可
5. **商品规格**：不支持多规格，一个商品一个价格
6. **退款功能**：不实现退款，只能取消待确认订单
7. **数据导出**：不实现 Excel 导出
8. **分类层级**：只做一级分类

### 保留核心
1. **双数据库**：MySQL + MongoDB 必须同时使用，体现技术点
2. **前后端分离**：展示完整的开发架构
3. **JWT 认证**：展示安全机制
4. **7 大模块**：功能完整，满足毕业设计要求
5. **数据可视化**：ECharts 图表展示

---

## 九、预期成果

### 功能完整性
- 居民端：可以浏览、下单、查看订单
- 团长端：可以管理商品、订单、居民、查看佣金和数据

### 技术展示
- 前后端分离架构
- MySQL + MongoDB 双数据库
- JWT 认证
- RESTful API
- Vue 3 组合式 API
- 数据可视化

### 毕业设计亮点
1. 双数据库设计（MySQL 负责核心业务，MongoDB 负责日志统计）
2. 完整的业务闭环（从商品上架到订单完成到佣金结算）
3. 数据看板可视化
4. 前后端分离现代架构

---

## 十、下一步

确认无误后，即可开始搭建项目框架，按照 3 天计划逐步实现功能。
